var Path={version:"0.8.4",map:function(t){return Path.routes.defined.hasOwnProperty(t)?Path.routes.defined[t]:new Path.core.route(t)},root:function(t){Path.routes.root=t},rescue:function(t){Path.routes.rescue=t},before:function(t,e){Path.routes.before.path=t,Path.routes.before.fn=e},history:{initial:{},pushState:function(t,e,o){Path.history.supported?Path.dispatch(o)&&history.pushState(t,e,o):Path.history.fallback&&(window.location.hash="#"+o)},popState:function(){var t=!Path.history.initial.popped&&location.href==Path.history.initial.URL;Path.history.initial.popped=!0,t||Path.dispatch(document.location.pathname)},listen:function(t){if(Path.history.supported=!(!window.history||!window.history.pushState),Path.history.fallback=t,Path.history.supported)Path.history.initial.popped="state"in window.history,Path.history.initial.URL=location.href,window.onpopstate=Path.history.popState;else if(Path.history.fallback){for(route in Path.routes.defined)"#"!=route.charAt(0)&&(Path.routes.defined["#"+route]=Path.routes.defined[route],Path.routes.defined["#"+route].path="#"+route);Path.listen()}}},beforeMatch:function(t){if(-1!=t.path.indexOf(Path.routes.before.path)){var e=Path.routes.before.fn();return void 0===e||e}return!0},match:function(t,e){var o,r,n,i,h,a={},s=null;for(s in Path.routes.defined)if(null!==s&&void 0!==s)for(s=Path.routes.defined[s],o=s.partition(),i=0;i<o.length;i++){if(r=o[i],h=t,r.search(/:/)>0)for(n=0;n<r.split("/").length;n++)n<h.split("/").length&&":"===r.split("/")[n].charAt(0)&&(a[r.split("/")[n].replace(/:/,"")]=h.split("/")[n],h=h.replace(h.split("/")[n],r.split("/")[n]));if(r===h)return e&&(s.params=a),s}return null},dispatch:function(t){var e,o;if(Path.routes.current!==t){if(Path.routes.previous=Path.routes.current,Path.routes.current=t,o=Path.match(t,!0),Path.routes.previous&&(e=Path.match(Path.routes.previous),null!==e&&null!==e.do_exit&&e.do_exit()),null!==o&&Path.beforeMatch(o))return o.run(),!0;null!==Path.routes.rescue&&Path.routes.rescue()}},listen:function(){var t=function(){Path.dispatch(location.hash)};""===location.hash&&null!==Path.routes.root&&(location.hash=Path.routes.root),Path.routes.before.fn||(Path.routes.before.fn=function(){return!0}),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=t:setInterval(t,50),""!==location.hash&&Path.dispatch(location.hash)},core:{route:function(t){this.path=t,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},Path.routes.defined[t]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{},before:{}}};Path.core.route.prototype={to:function(t){return this.action=t,this},enter:function(t){return t instanceof Array?this.do_enter=this.do_enter.concat(t):this.do_enter.push(t),this},exit:function(t){return this.do_exit=t,this},partition:function(){for(var t,e,o=[],r=[],n=/\(([^}]+?)\)/g;t=n.exec(this.path);)o.push(t[1]);for(r.push(this.path.split("(")[0]),e=0;e<o.length;e++)r.push(r[r.length-1]+o[e]);return r},run:function(){var t,e,o=!1;if(Path.routes.defined[this.path].hasOwnProperty("do_enter")&&Path.routes.defined[this.path].do_enter.length>0)for(t=0;t<Path.routes.defined[this.path].do_enter.length;t++)if(e=Path.routes.defined[this.path].do_enter[t].apply(this,null),e===!1){o=!0;break}o||Path.routes.defined[this.path].action()}};
