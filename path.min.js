!function(t){var e={version:"0.8.5",map:function(t){return e.routes.defined.hasOwnProperty(t)?e.routes.defined[t]:new e.core.route(t)},root:function(t){e.routes.root=t},rescue:function(t){e.routes.rescue=t},before:function(t,o){e.routes.before.path=t,e.routes.before.fn=o},history:{initial:{},pushState:function(t,o,r){e.history.supported?e.dispatch(r)&&history.pushState(t,o,r):e.history.fallback&&(window.location.hash="#"+r)},popState:function(){var t=!e.history.initial.popped&&location.href==e.history.initial.URL;e.history.initial.popped=!0,t||e.dispatch(document.location.pathname)},listen:function(t){if(e.history.supported=!(!window.history||!window.history.pushState),e.history.fallback=t,e.history.supported)e.history.initial.popped="state"in window.history,e.history.initial.URL=location.href,window.onpopstate=e.history.popState;else if(e.history.fallback){for(route in e.routes.defined)"#"!=route.charAt(0)&&(e.routes.defined["#"+route]=e.routes.defined[route],e.routes.defined["#"+route].path="#"+route);e.listen()}}},beforeMatch:function(t){if(-1!=t.path.indexOf(e.routes.before.path)){var o=e.routes.before.fn();return void 0===o||o}return!0},match:function(t,o){var r,n,i,s,u,h={},a=null;for(a in e.routes.defined)if(null!==a&&void 0!==a)for(a=e.routes.defined[a],r=a.partition(),s=0;s<r.length;s++){if(n=r[s],u=t,n.search(/:/)>0)for(i=0;i<n.split("/").length;i++)i<u.split("/").length&&":"===n.split("/")[i].charAt(0)&&(h[n.split("/")[i].replace(/:/,"")]=u.split("/")[i],u=u.replace(u.split("/")[i],n.split("/")[i]));if(n===u)return o&&(a.params=h),a}return null},dispatch:function(t){var o,r;if(e.routes.current!==t){if(e.routes.previous=e.routes.current,e.routes.current=t,r=e.match(t,!0),e.routes.previous&&(o=e.match(e.routes.previous),null!==o&&null!==o.do_exit&&o.do_exit()),null!==r&&e.beforeMatch(r))return r.run(),!0;null!==e.routes.rescue&&e.routes.rescue()}},listen:function(){var t=function(){e.dispatch(location.hash)};""===location.hash&&null!==e.routes.root&&(location.hash=e.routes.root),e.routes.before.fn||(e.routes.before.fn=function(){return!0}),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=t:setInterval(t,50),""!==location.hash&&e.dispatch(location.hash)},core:{route:function(t){this.path=t,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},e.routes.defined[t]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{},before:{}}};e.core.route.prototype={to:function(t){return this.action=t,this},enter:function(t){return t instanceof Array?this.do_enter=this.do_enter.concat(t):this.do_enter.push(t),this},exit:function(t){return this.do_exit=t,this},partition:function(){for(var t,e,o=[],r=[],n=/\(([^}]+?)\)/g;t=n.exec(this.path);)o.push(t[1]);for(r.push(this.path.split("(")[0]),e=0;e<o.length;e++)r.push(r[r.length-1]+o[e]);return r},run:function(){var t,o,r=!1;if(e.routes.defined[this.path].hasOwnProperty("do_enter")&&e.routes.defined[this.path].do_enter.length>0)for(t=0;t<e.routes.defined[this.path].do_enter.length;t++)if(o=e.routes.defined[this.path].do_enter[t].apply(this,null),o===!1){r=!0;break}r||e.routes.defined[this.path].action()}},"undefined"!=typeof module&&module.exports?module.exports.pathjs=e:t.pathjs=e}(this);
