(function(e){(function(t){if(typeof define==="function"&&define.amd){define(t)}else{e.Path=t()}})(function(){var t={version:"0.8.4",map:function(e){if(t.routes.defined.hasOwnProperty(e)){return t.routes.defined[e]}else{return new t.core.route(e)}},root:function(e){t.routes.root=e},rescue:function(e){t.routes.rescue=e},history:{initial:{},pushState:function(n,r,i){if(t.history.supported){if(t.dispatch(i)){history.pushState(n,r,i)}}else{if(t.history.fallback){e.location.hash="#"+i}}},popState:function(e){var n=!t.history.initial.popped&&location.href==t.history.initial.URL;t.history.initial.popped=true;if(n)return;t.dispatch(document.location.pathname)},listen:function(n){t.history.supported=!!(e.history&&e.history.pushState);t.history.fallback=n;if(t.history.supported){t.history.initial.popped="state"in e.history,t.history.initial.URL=location.href;e.onpopstate=t.history.popState}else{if(t.history.fallback){for(route in t.routes.defined){if(route.charAt(0)!="#"){t.routes.defined["#"+route]=t.routes.defined[route];t.routes.defined["#"+route].path="#"+route}}t.listen()}}}},match:function(e,n){var r={},i=null,s,o,u,a,f;for(i in t.routes.defined){if(i!==null&&i!==undefined){i=t.routes.defined[i];s=i.partition();for(a=0;a<s.length;a++){o=s[a];f=e;if(o.search(/:/)>0){for(u=0;u<o.split("/").length;u++){if(u<f.split("/").length&&o.split("/")[u].charAt(0)===":"){r[o.split("/")[u].replace(/:/,"")]=f.split("/")[u];f=f.replace(f.split("/")[u],o.split("/")[u])}}}if(o===f){if(n){i.params=r}return i}}}}return null},dispatch:function(e){var n,r;if(t.routes.current!==e){t.routes.previous=t.routes.current;t.routes.current=e;r=t.match(e,true);if(t.routes.previous){n=t.match(t.routes.previous);if(n!==null&&n.do_exit!==null){n.do_exit()}}if(r!==null){r.run();return true}else{if(t.routes.rescue!==null){t.routes.rescue()}}}},listen:function(){var n=function(){t.dispatch(location.hash)};if(location.hash===""){if(t.routes.root!==null){location.hash=t.routes.root}}if("onhashchange"in e&&(!document.documentMode||document.documentMode>=8)){e.onhashchange=n}else{setInterval(n,50)}if(location.hash!==""){t.dispatch(location.hash)}},core:{route:function(e){this.path=e;this.action=null;this.do_enter=[];this.do_exit=null;this.params={};t.routes.defined[e]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};t.core.route.prototype={to:function(e){this.action=e;return this},enter:function(e){if(e instanceof Array){this.do_enter=this.do_enter.concat(e)}else{this.do_enter.push(e)}return this},exit:function(e){this.do_exit=e;return this},partition:function(){var e=[],t=[],n=/\(([^}]+?)\)/g,r,i;while(r=n.exec(this.path)){e.push(r[1])}t.push(this.path.split("(")[0]);for(i=0;i<e.length;i++){t.push(t[t.length-1]+e[i])}return t},run:function(){var e=false,n,r,i;if(t.routes.defined[this.path].hasOwnProperty("do_enter")){if(t.routes.defined[this.path].do_enter.length>0){for(n=0;n<t.routes.defined[this.path].do_enter.length;n++){r=t.routes.defined[this.path].do_enter[n].apply(this,null);if(r===false){e=true;break}}}}if(!e){t.routes.defined[this.path].action()}}};return t})})(window)
