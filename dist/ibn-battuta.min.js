var Path={version:"0.8.4",map:function(path){return Path.routes.defined.hasOwnProperty(path)?Path.routes.defined[path]:new Path.core.route(path)},root:function(path){Path.routes.root=path},rescue:function(fn){Path.routes.rescue=fn},history:{initial:{},pushState:function(state,title,path){Path.history.supported?Path.dispatch(path)&&history.pushState(state,title,path):Path.history.fallback&&(window.location.hash="#"+path)},popState:function(event){var initialPop=!Path.history.initial.popped&&location.href==Path.history.initial.URL;Path.history.initial.popped=!0,initialPop||Path.dispatch(document.location.pathname)},listen:function(fallback){if(Path.history.supported=!(!window.history||!window.history.pushState),Path.history.fallback=fallback,Path.history.supported)Path.history.initial.popped="state"in window.history,Path.history.initial.URL=location.href,window.onpopstate=Path.history.popState;else if(Path.history.fallback){for(route in Path.routes.defined)"#"!=route.charAt(0)&&(Path.routes.defined["#"+route]=Path.routes.defined[route],Path.routes.defined["#"+route].path="#"+route);Path.listen()}}},match:function(path,parameterize){var possible_routes,slice,i,j,compare,params={},route=null;for(route in Path.routes.defined)if(null!==route&&void 0!==route)for(route=Path.routes.defined[route],possible_routes=route.partition(),j=0;j<possible_routes.length;j++){if(slice=possible_routes[j],compare=path,slice.search(/:/)>0)for(i=0;i<slice.split("/").length;i++)i<compare.split("/").length&&":"===slice.split("/")[i].charAt(0)&&(params[slice.split("/")[i].replace(/:/,"")]=compare.split("/")[i],compare=compare.replace(compare.split("/")[i],slice.split("/")[i]));if(slice===compare)return parameterize&&(route.params=params),route}return null},dispatch:function(passed_route){var previous_route,matched_route;if(Path.routes.current!==passed_route){if(Path.routes.previous=Path.routes.current,Path.routes.current=passed_route,matched_route=Path.match(passed_route,!0),Path.routes.previous&&(previous_route=Path.match(Path.routes.previous),null!==previous_route&&null!==previous_route.do_exit&&previous_route.do_exit()),null!==matched_route)return matched_route.run(),!0;null!==Path.routes.rescue&&Path.routes.rescue()}},listen:function(){var fn=function(){Path.dispatch(location.hash)};""===location.hash&&null!==Path.routes.root&&(location.hash=Path.routes.root),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=fn:setInterval(fn,50),""!==location.hash&&Path.dispatch(location.hash)},core:{route:function(path){this.path=path,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},Path.routes.defined[path]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};Path.core.route.prototype={to:function(fn){return this.action=fn,this},enter:function(fns){return fns instanceof Array?this.do_enter=this.do_enter.concat(fns):this.do_enter.push(fns),this},exit:function(fn){return this.do_exit=fn,this},partition:function(){for(var text,i,parts=[],options=[],re=/\(([^}]+?)\)/g;text=re.exec(this.path);)parts.push(text[1]);for(options.push(this.path.split("(")[0]),i=0;i<parts.length;i++)options.push(options[options.length-1]+parts[i]);return options},run:function(){var i,result,halt_execution=!1;if(Path.routes.defined[this.path].hasOwnProperty("do_enter")&&Path.routes.defined[this.path].do_enter.length>0)for(i=0;i<Path.routes.defined[this.path].do_enter.length;i++)if(result=Path.routes.defined[this.path].do_enter[i].apply(this,null),result===!1){halt_execution=!0;break}halt_execution||Path.routes.defined[this.path].action()}};